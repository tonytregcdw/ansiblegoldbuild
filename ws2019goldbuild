- hosts: azws2019
  gather_facts: false
  var_files:
    - variables.yaml
    
  tasks:

  - name: Run a command under cmd
    win_shell: echo ansible woz here >> C:\temp\tt.txt && echo still here >> c:\temp\tt.txt
    args:
      executable: cmd.exe

  - name: Run a powershell command
    win_shell: |
      New-Item -Path C:\temp\ttester -ItemType Directory
      write-host hello-mate >> c:\temp\ttester\mate.txt
      
  - name: Install notepad-plus-plus
    win_package:
      path: https://notepad-plus-plus.org/repository/7.x/7.0/npp.7.Installer.x64.exe
      product_id: Notepad++
      arguments: /S
      state: present
      
  - name: reg key
    win_regedit:
      path: HKLM:\Software\TTLAB
      name: hello
      data: world
      
  - name: dword reg key
    win_regedit:
      path: HKLM:\Software\TTLAB
      name: hellod
      data: 1
      type: dword
      
  - name: Enable RDS win feature  
    win_feature:
      name: RDS-RD-Server
      state: present
      include_management_tools: False
  
  - name: join Azure AD DS domain
    win_domain_membership:
      dns_domain_name: '{{ adds_fqdn }}'
      domain_admin_user: '{{ adds_admin_user }}'
      domain_admin_password: '{{ adds_admin_pass }}'
      state: domain
    register: domain_state
    
  - win_reboot:
    when: domain_state.reboot_required
  
